# RTSP/RTP Video Streaming - Architecture Diagrams

## System Architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    VIDEO STREAMING SYSTEM                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     CLIENT SIDE         â”‚                â”‚     SERVER SIDE         â”‚
â”‚                         â”‚                â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Client GUI    â”‚   â”‚                â”‚   â”‚  Server Main    â”‚  â”‚
â”‚  â”‚   (Tkinter)     â”‚   â”‚                â”‚   â”‚   (Listener)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚            â”‚                â”‚            â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  RTSP Client    â”‚   â”‚   TCP 8554     â”‚   â”‚  RTSP Handler   â”‚  â”‚
â”‚  â”‚   (Control)     â”‚â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–ºâ”‚   (Worker)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚            â”‚                â”‚            â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   RTP Client    â”‚   â”‚   UDP 25000    â”‚   â”‚   RTP Sender    â”‚  â”‚
â”‚  â”‚   (Receiver)    â”‚â—„â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”‚   (Streamer)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚            â”‚                â”‚            â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Video Display  â”‚   â”‚                â”‚   â”‚  Video Stream   â”‚  â”‚
â”‚  â”‚   (Frames)      â”‚   â”‚                â”‚   â”‚   (File Read)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚                â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## RTSP State Machine

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”
                    â”Œâ”€â”€â”€â–ºâ”‚ INIT â”‚â—„â”€â”€â”€â”
                    â”‚    â””â”€â”€â”€â”¬â”€â”€â”˜    â”‚
                    â”‚        â”‚       â”‚
                    â”‚     SETUP      â”‚
                    â”‚        â”‚       â”‚
                    â”‚    â”Œâ”€â”€â”€â–¼â”€â”€â”    â”‚
                    â”‚    â”‚READY â”‚    â”‚
                    â”‚    â””â”€â”€â”€â”¬â”€â”€â”˜    â”‚
                    â”‚        â”‚       â”‚
                    â”‚       PLAY     â”‚
                    â”‚        â”‚       â”‚
                    â”‚    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚
                    â”‚    â”‚PLAYING â”‚  â”‚
                    â”‚    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
                    â”‚        â”‚       â”‚
                    â”‚      PAUSE     â”‚
                    â”‚        â”‚       â”‚
                    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                 TEARDOWN
                    â”‚
                â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
                â”‚ CLOSE â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

## RTSP Protocol Flow

```
CLIENT                                SERVER
  â”‚                                     â”‚
  â”‚â”€â”€ SETUP video/movie.Mjpeg â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚   CSeq: 1                           â”‚
  â”‚   Transport: RTP/AVP;unicast;...    â”‚
  â”‚                                     â”‚
  â”‚â—„â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    CSeq: 1                          â”‚
  â”‚    Session: 1234567890              â”‚
  â”‚                                     â”‚
  â”‚â”€â”€ PLAY video/movie.Mjpeg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚   CSeq: 2                           â”‚
  â”‚   Session: 1234567890               â”‚
  â”‚                                     â”‚
  â”‚â—„â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    CSeq: 2                          â”‚
  â”‚    Session: 1234567890              â”‚
  â”‚                                     â”‚
  â”‚                                     â”‚
  â”œâ•â•â• RTP PACKETS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚
  â”œâ•â•â• (UDP Stream) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚
  â”œâ•â•â• Continuous... â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚
  â”‚                                     â”‚
  â”‚â”€â”€ PAUSE video/movie.Mjpeg â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚   CSeq: 3                           â”‚
  â”‚   Session: 1234567890               â”‚
  â”‚                                     â”‚
  â”‚â—„â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    CSeq: 3                          â”‚
  â”‚    (RTP stops)                      â”‚
  â”‚                                     â”‚
  â”‚â”€â”€ PLAY video/movie.Mjpeg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚   CSeq: 4                           â”‚
  â”‚   Session: 1234567890               â”‚
  â”‚                                     â”‚
  â”‚â—„â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    CSeq: 4                          â”‚
  â”‚                                     â”‚
  â”œâ•â•â• RTP PACKETS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚
  â”œâ•â•â• (Resumed)    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–ºâ”‚
  â”‚                                     â”‚
  â”‚â”€â”€ TEARDOWN video/movie.Mjpeg â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚   CSeq: 5                           â”‚
  â”‚   Session: 1234567890               â”‚
  â”‚                                     â”‚
  â”‚â—„â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚    CSeq: 5                          â”‚
  â”‚    (Connection closed)              â”‚
  â”‚                                     â”‚
```

## RTP Packet Structure

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      RTP PACKET (12+ bytes)                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Byte 0: [V V P X C C C C]                                    â•‘
â•‘          V(2): Version = 2                                     â•‘
â•‘          P(1): Padding = 0                                     â•‘
â•‘          X(1): Extension = 0                                   â•‘
â•‘          C(4): CSRC Count = 0                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Byte 1: [M P P P P P P P]                                    â•‘
â•‘          M(1): Marker = 0                                      â•‘
â•‘          P(7): Payload Type = 26 (MJPEG)                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Bytes 2-3: Sequence Number (0-65535)                         â•‘
â•‘             Increments for each packet                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Bytes 4-7: Timestamp (32-bit)                                â•‘
â•‘             90kHz clock (time.time() * 90000)                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Bytes 8-11: SSRC (Synchronization Source)                    â•‘
â•‘              = Session ID                                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Bytes 12+: Payload (JPEG Frame Data)                         â•‘
â•‘             Variable length (~13KB average)                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## MJPEG File Format

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    MJPEG FILE STRUCTURE                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ Frame 1:                                             â”‚    â•‘
â•‘  â”‚   [5 bytes] Length: "13456"                          â”‚    â•‘
â•‘  â”‚   [13456 bytes] JPEG data                            â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ Frame 2:                                             â”‚    â•‘
â•‘  â”‚   [5 bytes] Length: "13201"                          â”‚    â•‘
â•‘  â”‚   [13201 bytes] JPEG data                            â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ Frame 3:                                             â”‚    â•‘
â•‘  â”‚   [5 bytes] Length: "13598"                          â”‚    â•‘
â•‘  â”‚   [13598 bytes] JPEG data                            â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                                â•‘
â•‘  ... (continues for all frames)                               â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Multi-Client Architecture

```
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   RTSP Server    â”‚
                      â”‚   (Port 8554)    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚          â”‚          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Worker 1   â”‚   â”‚Worker 2 â”‚   â”‚  Worker 3   â”‚
        â”‚ Session:    â”‚   â”‚Session: â”‚   â”‚  Session:   â”‚
        â”‚  12345      â”‚   â”‚ 12346   â”‚   â”‚   12347     â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚               â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚ RTP Stream  â”‚ â”‚ RTP Stream  â”‚ â”‚ RTP Stream  â”‚
        â”‚  (Thread)   â”‚ â”‚  (Thread)   â”‚ â”‚  (Thread)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚               â”‚               â”‚
          UDP:25000       UDP:25002       UDP:25004
               â”‚               â”‚               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚  Client 1   â”‚ â”‚  Client 2   â”‚ â”‚  Client 3   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Thread Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SERVER PROCESS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Main Thread (Server)                            â”‚     â”‚
â”‚  â”‚  - Accept connections                            â”‚     â”‚
â”‚  â”‚  - Create worker threads                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                 â”‚                                           â”‚
â”‚                 â”‚ spawns                                    â”‚
â”‚                 â”‚                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     â”‚           â”‚                   â”‚                     â”‚
â”‚  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”                â”‚
â”‚  â”‚Worker 1â”‚ â”‚Worker 2â”‚  ...   â”‚Worker Nâ”‚                â”‚
â”‚  â”‚Thread  â”‚ â”‚Thread  â”‚        â”‚Thread  â”‚                â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                â”‚
â”‚      â”‚          â”‚                  â”‚                     â”‚
â”‚      â”‚ spawns   â”‚ spawns           â”‚ spawns              â”‚
â”‚      â”‚          â”‚                  â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”                â”‚
â”‚  â”‚ RTP    â”‚ â”‚ RTP    â”‚  ...   â”‚ RTP    â”‚                â”‚
â”‚  â”‚Stream 1â”‚ â”‚Stream 2â”‚        â”‚Stream Nâ”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT PROCESS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Main Thread (GUI)                               â”‚     â”‚
â”‚  â”‚  - Display interface                             â”‚     â”‚
â”‚  â”‚  - Handle button clicks                          â”‚     â”‚
â”‚  â”‚  - Send RTSP commands                            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                 â”‚                                           â”‚
â”‚                 â”‚ spawns                                    â”‚
â”‚                 â”‚                                           â”‚
â”‚            â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚            â”‚   RTP Thread â”‚                                â”‚
â”‚            â”‚   (Receiver) â”‚                                â”‚
â”‚            â”‚   - Receive  â”‚                                â”‚
â”‚            â”‚   - Decode   â”‚                                â”‚
â”‚            â”‚   - Display  â”‚                                â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Video File â”‚
â”‚   .Mjpeg   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚ Read frame
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VideoStream    â”‚
â”‚  nextFrame()   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Frame data (JPEG)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RTP Packet    â”‚
â”‚   encode()     â”‚
â”‚  - Header      â”‚
â”‚  - Payload     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ RTP packet bytes
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UDP Socket   â”‚
â”‚    sendto()    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Network transmission
       â–¼
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  (Network)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UDP Socket   â”‚
â”‚   recvfrom()   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ RTP packet bytes
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RTP Packet    â”‚
â”‚   decode()     â”‚
â”‚  - Parse hdr   â”‚
â”‚  - Extract pay â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ JPEG data
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PIL Image     â”‚
â”‚  Image.open()  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Image object
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PhotoImage    â”‚
â”‚  (Tkinter)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Display
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GUI Label    â”‚
â”‚   (Screen)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Timing Diagram

```
Time â†’
0ms        50ms       100ms      150ms      200ms      250ms
â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
â”œâ”€Frame 1â”€â”€â”¼â”€Frame 2â”€â”€â”¼â”€Frame 3â”€â”€â”¼â”€Frame 4â”€â”€â”¼â”€Frame 5â”€â”€â”¼â”€...
â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
Server:
â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
â”œâ”€Readâ”€â”€â”€â”€â”€â”¼â”€Readâ”€â”€â”€â”€â”€â”¼â”€Readâ”€â”€â”€â”€â”€â”¼â”€Readâ”€â”€â”€â”€â”€â”¼â”€Readâ”€â”€â”€â”€â”€â”¼
â”œâ”€Encodeâ”€â”€â”€â”¼â”€Encodeâ”€â”€â”€â”¼â”€Encodeâ”€â”€â”€â”¼â”€Encodeâ”€â”€â”€â”¼â”€Encodeâ”€â”€â”€â”¼
â”œâ”€Send RTPâ”€â”¼â”€Send RTPâ”€â”¼â”€Send RTPâ”€â”¼â”€Send RTPâ”€â”¼â”€Send RTPâ”€â”¼
â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
â”‚  â•²       â”‚  â•²       â”‚  â•²       â”‚  â•²       â”‚  â•²       â”‚
â”‚   â•²      â”‚   â•²      â”‚   â•²      â”‚   â•²      â”‚   â•²      â”‚
â”‚    â•²     â”‚    â•²     â”‚    â•²     â”‚    â•²     â”‚    â•²     â”‚
â”‚     â•²    â”‚     â•²    â”‚     â•²    â”‚     â•²    â”‚     â•²    â”‚
â”‚      â•²   â”‚      â•²   â”‚      â•²   â”‚      â•²   â”‚      â•²   â”‚
Client:    â”‚       â•²  â”‚       â•²  â”‚       â•²  â”‚       â•²  â”‚
â”‚          â”‚        â•² â”‚        â•² â”‚        â•² â”‚        â•² â”‚
â”‚          â”œâ”€Receiveâ”€â”¼â”€Receiveâ”€â”¼â”€Receiveâ”€â”¼â”€Receiveâ”€â”¼â”€Receiveâ”€
â”‚          â”œâ”€Decodeâ”€â”€â”¼â”€Decodeâ”€â”€â”¼â”€Decodeâ”€â”€â”¼â”€Decodeâ”€â”€â”¼â”€Decodeâ”€â”€
â”‚          â”œâ”€Displayâ”€â”¼â”€Displayâ”€â”¼â”€Displayâ”€â”¼â”€Displayâ”€â”¼â”€Displayâ”€
â”‚          â”‚          â”‚          â”‚          â”‚          â”‚

Frame Rate: 20 FPS = 50ms per frame
Network Latency: ~5-10ms (local)
Processing Time: ~5ms per frame
```

## Project File Structure

```
anan/
â”‚
â”œâ”€â”€ ğŸ“„ Server.py              (289 lines)
â”‚   â”œâ”€â”€ Server class
â”‚   â”œâ”€â”€ ServerWorker class
â”‚   â””â”€â”€ VideoStream class
â”‚
â”œâ”€â”€ ğŸ“„ Client.py              (334 lines)
â”‚   â””â”€â”€ Client class (GUI + RTSP + RTP)
â”‚
â”œâ”€â”€ ğŸ“„ RtpPacket.py           (169 lines)
â”‚   â””â”€â”€ RtpPacket class
â”‚
â”œâ”€â”€ ğŸ“„ VideoPrep.py           (250 lines)
â”‚   â”œâ”€â”€ video_to_mjpeg()
â”‚   â”œâ”€â”€ create_test_video()
â”‚   â””â”€â”€ get_video_info()
â”‚
â”œâ”€â”€ ğŸ“„ requirements.txt       (2 lines)
â”‚   â”œâ”€â”€ Pillow>=10.0.0
â”‚   â””â”€â”€ opencv-python>=4.8.0
â”‚
â”œâ”€â”€ ğŸ“„ .gitignore            (15 lines)
â”‚
â”œâ”€â”€ ğŸ“„ run.bat               (Interactive menu)
â”‚
â”œâ”€â”€ ğŸ“‹ README.md             (Full documentation)
â”œâ”€â”€ ğŸ“‹ QUICKSTART.md         (5-minute guide)
â”œâ”€â”€ ğŸ“‹ TESTING.md            (Test procedures)
â”œâ”€â”€ ğŸ“‹ PROJECT_SUMMARY.md    (Project overview)
â”‚
â””â”€â”€ ğŸ“ video/
    â””â”€â”€ ğŸ¬ movie.Mjpeg       (Test video - 200 frames)
```

---

**These diagrams illustrate the complete architecture and data flow of the RTSP/RTP Video Streaming system.**
